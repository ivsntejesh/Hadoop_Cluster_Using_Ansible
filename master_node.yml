- hosts: namenode 
  vars_files:
          - var.yml
  tasks:
          - copy:
                  dest: "/root/"
                  src: "/ansible-ws/task-11.1/jdk-8u171-linux-x64.rpm"

          - copy:
                  dest: "/root/"
                  src: "/ansible-ws/task-11.1/hadoop-1.2.1-1.x86_64.rpm"

          - command: "rpm -ivh jdk-8u171-linux-x64.rpm"
            register: x
            ignore_errors: yes

          - debug:
                  var: x.stdout

          - command: "rpm -ivh hadoop-1.2.1-1.x86_64.rpm --force"
            register: y
            ignore_errors: yes

          - debug:
                  var: y.stdout
          
          - shell: "rm -rf {{ master_dir }}"
            ignore_errors: yes
            register: rm_dir

          - debug:
                  var: rm_dir.stdout

          - file:
                  state: directory
                  path: "{{ master_dir }}"

          - copy:
                  dest: "/etc/hadoop/hdfs-site.xml"
                  src: "/ansible-ws/task-11.1/hdfs-site.xml"

          - copy:
                  dest: "/etc/hadoop/core-site.xml"
                  src: "/ansible-ws/task-11.1/core-site.xml"


          - blockinfile:
                  path: "/etc/hadoop/hdfs-site.xml"
                  insertafter: <property>
                  block: |
                         <name>{{ master }}</name>
                         <value>{{ master_dir }}</value>
          - debug:
                  var: groups['namenode']

          - blockinfile:
                  path: "/etc/hadoop/core-site.xml"
                  insertafter: </name>
                  block: 
                          <value>hdfs://{{ ansible_facts["default_ipv4"]["address"] }}:9001</value> 

          - shell: "hadoop-daemon.sh stop namenode"
            ignore_errors: yes
            register: "stop_namenode"

          - debug:
                  var: stop_namenode.stdout

          - shell: "echo Y | hadoop namenode -format"

          - command: "hadoop-daemon.sh start namenode"
            ignore_errors: yes
            register: start_namenode

          - debug:
                  var: start_namenode.stdout

          - command: "jps"
            register: run_jps

          - debug:
                  var: run_jps.stdout

          - command: "hadoop dfsadmin -report"
            register: report

          - debug:
                  var: report.stdout
